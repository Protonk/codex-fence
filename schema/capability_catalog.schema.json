{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Sandbox capability catalog (v1)",
  "type": "object",
  "required": [
    "schema_version",
    "catalog",
    "scope",
    "docs",
    "capabilities"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "sandbox_catalog_v1"
    },
    "catalog": {
      "type": "object",
      "required": ["key", "title"],
      "additionalProperties": false,
      "properties": {
        "key": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_.-]+$"
        },
        "title": {"type": "string"},
        "description": {"type": "string"},
        "labels": {
          "type": "array",
          "items": {"type": "string"},
          "uniqueItems": true
        },
        "notes": {"type": "string"}
      }
    },
    "scope": {
      "type": "object",
      "required": ["description", "categories"],
      "additionalProperties": false,
      "properties": {
        "description": {"type": "string"},
        "notes": {"type": "string"},
        "policy_layers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "description"],
            "additionalProperties": false,
            "properties": {
              "id": {"type": "string"},
              "description": {"type": "string"}
            }
          }
        },
        "categories": {
          "type": "object",
          "additionalProperties": {"type": "string"}
        },
        "limitations": {"type": "string"}
      }
    },
    "docs": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["title"],
        "additionalProperties": false,
        "properties": {
          "title": {"type": "string"},
          "url": {"type": "string"},
          "url_hint": {"type": "string"}
        }
      }
    },
    "capabilities": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "category", "layer", "description", "operations"],
        "additionalProperties": false,
        "properties": {
          "id": {"type": "string"},
          "category": {"type": "string"},
          "layer": {"type": "string"},
          "description": {"type": "string"},
          "status": {"type": "string"},
          "labels": {
            "type": "array",
            "items": {"type": "string"},
            "uniqueItems": true
          },
          "operations": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "allow": {
                "type": "array",
                "items": {"type": "string"}
              },
              "deny": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "meta_ops": {
            "type": "array",
            "items": {"type": "string"}
          },
          "agent_controls": {
            "type": "array",
            "items": {"type": "string"}
          },
          "notes": {"type": "string"},
          "sources": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["doc"],
              "additionalProperties": false,
              "properties": {
                "doc": {"type": "string"},
                "section": {"type": "string"},
                "url_hint": {"type": "string"}
              }
            }
          }
        }
      }
    }
  }
}
